package ada95compiler;

import java_cup.runtime.*;

/* Lexer*/
  parser code {:
      AdaLexer lexer;

      public ParserAda(AdaLexer lex){
       super(lex);
       lexer = lex;
      }


  :}



 /* Terminals */

 /* Types*/
  terminal        INTEGER,BOOLEAN,FLOAT;    

 /* Booleans*/
  terminal        TRUE,FALSE;

 /* arithmetic operations*/
  terminal        ADD,MIN,POT,MUL,DIV,UMIN; 
  
 /* logical expressions */
  terminal        AND,OR,NOT;

 /* I/O */
  terminal        GET,PUT;

 /* control structures */
  terminal        IF,THEN,ELSIF,ELSE,FOR,LOOP,EXIT,WHEN,WHILE;

 /* other symbols */
  terminal        COMMA,SEMICOLON,COLON,LPAR,RPAR,RANK;

 /* Blocks */
  terminal        PROCEDURE,IS,BEGIN,END,DECLARE;

 /* Functions*/
  terminal        FUNCTION,RETURN;

 /* variables */
  terminal String ID;

 /* Numbers */
  terminal Float   FLOATN;
  terminal Integer INTEGERN;

 /* Strings*/
  terminal String  STRINGCONT;

 
 /* Boolean operators*/
  terminal        LEQUAL,GEQUAL,DISTINCT,GREATER,LESS,EQUAL;
 
 /*  Assignment operator */
  terminal        ASSIGN;

 /* parameters */
  terminal        INOUT,IN,OUT;

 /* main */
  terminal        MAIN;  

 /* Non terminals*/
 non terminal         arit_expre, expression; 
 non terminal         literal_expre;
 non terminal         boolean_expre;
 non terminal         logical_expre;
 non terminal         declare_expre, variable_list;
 non terminal         type;
 non terminal         statement;
 non terminal         assignment_expre;
 non terminal         io_expre;
 non terminal         function_call;
 non terminal         arguments_list;
 non terminal         if_statement;
 non terminal         elsif_statement;
 non terminal         while_statement;
 non terminal         loop_statement, exit_statement;     

/* precedence */
precedence left     AND,OR;
precedence left     LEQUAL,GEQUAL,GREATER,DISTINCT,LESS,EQUAL; 
precedence left     ADD,MIN;
precedence left     MUL,DIV;
precedence right    POT,NOT,UMIN; 
precedence nonassoc ELSE;

 /* CFG */
statement ::= declare_expre:e1 SEMICOLON
              {: System.out.println(e1+";");:}
              | expression:e1 SEMICOLON
              {:RESULT=e1; System.out.println(e1+";");:}
              | assignment_expre:e1 SEMICOLON
              {: RESULT=e1; System.out.println(e1+";");:}
              | io_expre:e1 SEMICOLON
              {: RESULT=e1;System.out.println(e1+";");:}
              | if_statement:e1 SEMICOLON
              {:RESULT=e1;System.out.println(e1+";");:}
              | while_statement:e1 SEMICOLON
              {: RESULT =e1; System.out.println(e1+";");:}
              | exit_statement: e1 SEMICOLON
              {: RESULT=e1; System.out.println(e1+";");:}
              | loop_statement:e1 SEMICOLON
              {: RESULT=e1; System.out.println(e1+";");:}
;

expression ::= ID:id
                {: RESULT = id;:}   
                | literal_expre:le
                {: RESULT = le;:}  
                | arit_expre:ar
                {: RESULT = ar;:}
                | LPAR expression:e1 RPAR
                {:RESULT=e1; :}
                | boolean_expre:be
                {: RESULT=be; :}
                |logical_expre:le
                {:RESULT=le; :}
                |function_call:e1
                {:RESULT=e1; :}  
 ; 

 literal_expre ::= FLOATN:num
                   {: RESULT = num;:} 
                   |INTEGERN:num1
                   {: RESULT = num1;:}
                   |STRINGCONT:s
                   {: RESULT= s;:} 
                    
 ;

 arit_expre ::= expression:e1 ADD expression:e2 
               {: System.out.println(e1+"+"+e2); :}  
               | expression:e1 MIN expression:e2 
               {: System.out.println(e1+"-"+e2); :}
               | expression:e1 MUL expression:e2
               {: System.out.println(e1+"*"+e2); :} 
               |expression:e1 DIV expression:e2
               {: System.out.println(e1+"/"+e2); :}  
               | expression:e1 POT expression:e2
               {: System.out.println(e1+"**"+e2); :}
               | MIN expression:e1
               {: System.out.println("-"+e1);:}
               %prec UMIN
               

 ;

 boolean_expre ::= expression:e1 LEQUAL expression:e2
                  {: System.out.println(e1+"<="+e2); :}
                  | expression:e1 GEQUAL expression:e2
                  {: System.out.println(e1+">="+e2); :}  
                  | expression:e1 DISTINCT expression:e2
                  {: System.out.println(e1+"/="+e2); :}
                  | expression:e1 GREATER expression:e2
                  {: System.out.println(e1+">"+e2); :}
                  | expression:e1 LESS expression:e2
                  {: System.out.println(e1+"<"+e2); :} 
                  | expression:e1 EQUAL expression:e2
                  {: System.out.println(e1+"="+e2); :} 
 ;

 logical_expre ::= expression:e1 AND expression:e2
                   {: System.out.println(e1+"and"+e2); :} 
                   | expression:e1 OR expression:e2
                   {: System.out.println(e1+"or"+e2);:}
                   | NOT expression:e1
                   {: System.out.println("not"+e1);:}
                   |TRUE
                   {: System.out.println("true");:}
                   |FALSE
                   {: System.out.println("false");:} 
 ;

 type ::= INTEGER
          {:System.out.println("integer");:} 
          |BOOLEAN
          {:System.out.println("boolean");:}
          |FLOAT
          {:System.out.println("float");:} 
 ;

 declare_expre ::= variable_list:e1 COLON type:e2
                   {: RESULT=e1;System.out.println(e1+ ":"+e2);:}
 ;

 variable_list::= ID:e1
                  {:RESULT=e1; System.out.println(e1);:} 
                  |variable_list:e1 COMMA ID:e2
                  {:System.out.println(e1+","+e2);:}

 ;

 assignment_expre ::= ID:e1 ASSIGN:e2 expression:e3
                      {:System.out.println(e1+":="+e3);:}
 ;

 io_expre ::= GET LPAR ID:e1 RPAR
              {: System.out.println("get"+"("+e1+")"); :}
              | PUT LPAR expression:e1 RPAR
              {: System.out.println("put"+"("+e1+")"); :}
 ;

 function_call ::= ID:e1 LPAR arguments_list:e2 RPAR
                   {: System.out.println(e1+"("+e2+")"); :}
                   |ID:e1 LPAR RPAR 
                   {: System.out.println(e1+"("+")"); :}
 ;

 arguments_list ::= expression:e1
                    {: RESULT=e1; System.out.println(e1);:}
                    |arguments_list:e1 COMMA expression:e2
                    {: System.out.println(e1+","+e2);:} 
 ;

 if_statement ::= IF expression:e1 THEN statement:e2 END IF
                  {: System.out.println("if "+e1+" then "+e2+" end if "); :} 
                  | IF expression:e1 THEN statement:e2 elsif_statement:e3 END IF
                  {: System.out.println("if "+e1+" then "+e2+" "+e3+" end if "); :}
                  | IF expression:e1 THEN statement:e2 ELSE statement:e3 END IF
                  {: System.out.println("if "+e1+" then "+e2+" else "+e3+" end if "); :}
                  | IF expression:e1 THEN statement:e2 elsif_statement:e3  ELSE statement:e4 END IF
                  {: System.out.println("if "+e1+" then "+e2+" "+e3+ " else "+e4+" end if "); :}  


 ;

 elsif_statement ::= ELSIF expression:e1 THEN statement:e2 elsif_statement:e3
                     {: System.out.println("elsif "+e1+" then "+e2+ "  "+e3); :}
                     | ELSIF expression:e1 THEN statement:e2
                     {: System.out.println("elsif "+e1+" then "+e2+ "  ");:}
 ;

 while_statement ::= WHILE expression:e1 LOOP statement:e2 END LOOP
                     {: System.out.println("while  "+e1+" loop "+e2+ "  END LOOP"); :}
 ;

 exit_statement ::= EXIT WHEN expression:e1
                    {: System.out.println("exit when "+e1); :}
 ;

 loop_statement ::= LOOP statement:e1 END LOOP
                    {: System.out.println("loop  "+e1+ " end loop "); :}
 ;                
